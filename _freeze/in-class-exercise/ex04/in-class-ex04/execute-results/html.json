{
  "hash": "88962ef15176148be5ba4a508ff45b73",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"04 In-class Exercise 4 (Review)\"\nauthor: \"Heng Kuan Xin\"\ndate: 2024-09-09\ndate-modified: \"last-modified\"\nexecute:\n  eval: false\n  echo: true\n  freeze: true\n  output: true\n  warning: false\n  error: false\ntoc-depth: 5\n---\n\n\n\nEval set to False\n\n# Previous Lessons' Notes\n\nIssue 1: Rendering ICE3 Map -\\> rendering tmap view for ICE3\n\nproblem is in the leaflet library packages try development version 3.99.9 -\\> rather than version 4 but it is likely to contain unexpected bugs, feel free to try it out\n\nExpose you to different data portals, open sources, open data access Get used to different data types, knowing what to use, when to use.\n\n## Starting you with Takehome Exercise 1\n\nGeneral knowledge on Myanmar-Singapore economy:\n\n-   Sand import from Myanmar\n-   Jade import from Myanmar\n\n--\\> refer to Take Home Exercise 01 for further notes.\n\n# In-class Exercise\n\nrefer to website:\n\n## 0.0 Install and Loading R Packages\n\nThe main package we want to use for spatial-temporal point pattern analysis is sparr:\n\n**sparr** provides functions to estimate fixed and adaptive kernel-smoothed spatial relative risk surfaces via the density-ratio method and perform subsequent inference. Fixed-bandwidth spatiotemporal density and relative risk estimation is also supported.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##| eval: false\n\npacman::p_load(sf, tidyverse, tmap, sparr, spatstat, raster)\n```\n:::\n\n\n\nSpatio-Temporal Patterns\n\nNote that when we are studying patterns, we are not necessarily studying causation, we want to identify whether there are any underlying patterns of the spread of spatial-temporal points, and whether there are correlation between the factors; such factors can be socio-economic levels, terrain, culture, etc.\n\n## 1.0 Importing Data\n\n(Copied from Exercise) The data:\n\nFor the purpose of this exercise, two data sets are used, they are:\n\n-   forestfires, a csv file provides locations of forest fire detected from the Moderate Resolution Imaging Spectroradiometer (MODIS) sensor data. The data are downloaded from [Fire Information for Resource Management System](https://firms.modaps.eosdis.nasa.gov/download/). For the purpose of this exercise, only forest fires within Kepulauan Bangka Belitung will be used.\n\n-   Kepulauan_Bangka_Belitung, an ESRI shapefile showing the sub-district (i.e.Â [kelurahan](https://en.wikipedia.org/wiki/Villages_of_Indonesia)) boundary of Kepulauan Bangka Belitung. The data set was downloaded from [Indonesia Geospatial](https://www.indonesia-geospasial.com/2023/05/download-shapefile-batas-administrasi.html) portal. The original data covers the whole Indonesia. For the purpose of this exercise, only **sub-districts within Kepulauan Bangka Belitung** are extracted.\n\n### 1.1 Load in the Study Area Shapefile\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##| eval: false\n# load in the study area. Note Kota refer to urban village/city. Desa refer to rural village.\n# note the Polygon contains a Z dimension, which will interfere with analysis if you try to convert to PPP.\n# you can drop away the Z if not needed.\n# kbb_raw <- st_read(dsn = \"data/rawdata/\", layer = \"Kepulauan_Bangka_Belitung\")\n\nstudyArea_sf <- st_read(dsn = \"data/rawdata/\", layer = \"Kepulauan_Bangka_Belitung\")  %>%\n  st_union() %>% # union all the boundaries so you only have an outline\n  st_zm(drop = TRUE, what = \"ZM\") %>% # remove Z dimension\n  st_transform(crs= 32748) # transform to the appropriate projected CRS\n```\n:::\n\n\n\n### 1.2 Load in the Forest Fire Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##| eval: false\n# load in the the forest fire points.\n# forestFire_raw <- read_csv(file=\"data/rawdata/forestfires.csv\")\n\nforestFire_sf <- read_csv(file=\"data/rawdata/forestfires.csv\") %>%\n  st_as_sf(coords = c(\"longitude\",\"latitude\"),\n           crs = 4326) %>%\n  st_transform(crs=32748)\n```\n:::\n\n\n\nCaution: when you use read.csv, your fieldnames cannot contain whitespaces, any whitespaces, it will insert a dot; your fieldnames will change. Instead, when you use read_csv from the readr package (part of tidyverse), the output is a tibble dataframe, though without geometry (which we will assign when we transform it into sf). In this case, since all the fieldnames contain no whitespaces, there are no issues with using read.csv()\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# forestfire_test <- read.csv(file=\"data/rawdata/forestfires.csv\")\n# class(forestfire_test)\n```\n:::\n\n\n\n## 2.0 Data Wrangling\n\n### 2.1 Generate the window Owin Class of Study Area.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudyArea_owin <- as.owin(studyArea_sf)\nstudyArea_owin\nclass(studyArea_owin)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nforestFire_sf <- forestFire_sf %>%\n  mutate(DayofYear = yday(acq_date)) %>% # day of the year from 1 to 365\n  mutate(Month_num = month(acq_date)) %>% # month of the year returned as numbers from 1 to 12\n  mutate(Month_fac = month(acq_date, # month of the year returned as factors and not abbreviated -> January, February\n                           label = TRUE,\n                           abbr = FALSE))\n```\n:::\n\n\n\nThe tool we are using to handle the dates is called [lubridate](https://lubridate.tidyverse.org/)(part of tidyverse) -\\> useful for all sorts of manipulations on dates and time, including quarter years, ewidth, and so on.\n\nThe tool for data manipulation (e.g. mutate) is called [dyplr](https://dplyr.tidyverse.org/)-\\> useful for data manipulations\n\n### 2.2 Quick Glance at the Data\n\n[tmap](https://r-tmap.github.io/tmap/) allows us to make cartographic quality map, including interactive maps (not always loadable)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n\ntm_shape(studyArea_sf) +\n    tm_polygons() +\n  tm_shape(forestFire_sf) +\n    tm_dots(size= 0.1) + # make sizes a bit bigger so that it can be seen\n  tm_facets(by=\"Month_fac\",\n            free.coords = TRUE,# if TRUE, all maps will be zoomed in on data points extent\n            drop.units = TRUE)\n  tmap_mode(\"plot\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n\ntm_shape(studyArea_sf) +\n    tm_polygons() +\n  tm_shape(forestFire_sf) +\n    tm_dots(size= 0.1) + # make sizes a bit bigger so that it can be seen\n  tm_facets(by=\"Month_fac\",\n            free.coords = FALSE,# if TRUE, all maps will be zoomed in on data points extent\n            drop.units = TRUE)\n  tmap_mode(\"plot\")\n```\n:::\n\n\n\n## 3.0 Computing STKDE by Month\n\nsparr is designed for events vs control comparison (used in medical science)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_month <- forestFire_sf %>%\n  select(`Month_num`)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_month_ppp <- as.ppp(fire_month)\nfire_month_ppp\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fire_month_ppp)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_month_owin <- fire_month_ppp[studyArea_owin]\nsummary(fire_month_owin)\n```\n:::\n\n\n\n### 3.1 Computing Spatio-Temporal KDE\n\nReading the results:\n\nfunction gives you bandwidths:\n\nh (spatial) -\\> 15102.47 metres\n\nlambda (temporal) -\\> 0.03months\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_kde <- spattemp.density(fire_month_owin)\nsummary(st_kde)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#| fig-width: 12\n#| fig-height: 10\n\n# you can specify your plot area so that the graph features are not crammed together\n\ntrims <- c(7,8,9,10,11,12) # trim, since we saw that most fires only started July onwards\n\npar(mfcol=c(2,3)) # result will have 2 rows, 3 columns\n\nfor(i in trims){\n  plot(st_kde, i,\n       override.par=FALSE,\n       fix.range=TRUE,\n       main=paste(\"KDE at month\", i))\n}\n```\n:::\n\n\n\nReading the results:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkde_yday <- spattemp.density(\n  fire_yday_owin)\n\nsummary(kde_yday)\n```\n:::\n\n\n\nRather than visualising a static image, try to plot it on an animated image:\n\nrefer to <https://tilmandavies.github.io/sparr/articles/fmd_animation/fmd_animation.html>\n\nrefer to <https://github.com/tilmandavies/sparr/blob/HEAD/vignettes/fmd_animation/fmd_animation.Rmd>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}